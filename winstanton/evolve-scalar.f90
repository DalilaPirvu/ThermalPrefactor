#include "macros.h"
#define SMOOTH 1

program Gross_Pitaevskii_1d
  use, intrinsic :: iso_c_binding
  use gaussianRandomField
  use integrator
  use constants
  use eom
  implicit none

  integer :: sim
  real(dl), pointer :: time
  real(dl), dimension(:,:), pointer :: fld
  type(transformPair1D) :: tPairgsq

  fld(1:nLat,1:2) => yvec(1:nVar-1) ! store the field in yvec
  time => yvec(nVar) ! last position stores the time?
  call initialize_rand(93286123, seedfac)
  call setup(nVar)

  ! change this script to vary over specific parameters, as needed
  print*, "Temperature ", temp

  do sim = 0, nSim-1
      call initialise_fields(fld)
      if (sim >= lSim) then
!          if (ANY(simList==sim)) then
         call time_evolve(sim, alph)
         print*, "Simulation ", sim+1, " out of ", nSim , " done!"
!          endif
      endif
  end do
  print*, "All Done!"

contains

  subroutine initialise_fields(fld)
    real(dl), dimension(:,:), intent(inout) :: fld

!!! shoot start point: 1.414 / 1.41479

!!! sub-critical
    fld(:,1)   = fldinit + (/0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.33696752724546e-05, 0.00024578586633974006, 0.00045859614295390536, 0.000672141713750514, 0.0008867649487221846, 0.00110280994503885, 0.0013206231201380466, 0.001540553712717782, 0.0017629543462570683, 0.00198818158187645, 0.0022165965118113085, 0.0024485653850907416, 0.0026844601326867328, 0.002924658968262433, 0.0031695469736482216, 0.0034195167498849827, 0.003674969113449635, 0.003936313645827992, 0.004203969356709037, 0.004478365331563373, 0.004759941463018148, 0.005049149232986498, 0.005346452327423158, 0.005652327387935245, 0.005967264747583677, 0.0062917692698107805, 0.006626361242333798, 0.006971577086843333, 0.007327970228247594, 0.007696111942149527, 0.008076592341573381, 0.008470021426720192, 0.008877029901967795, 0.0092982701985523, 0.009734417507348367, 0.010186170901399939, 0.010654254506163066, 0.01113941858312304, 0.011642440724412114, 0.012164127097144649, 0.012705313823453024, 0.013266868224347979, 0.013849690204524702, 0.014454713680941322, 0.015082908138322616, 0.01573528013445323, 0.01641287489661485, 0.017116777956511214, 0.017848116969337177, 0.018608063478228305, 0.019397834730351754, 0.020218695612866787, 0.021071960682162837, 0.021958996269094696, 0.022881222615602922, 0.023840116137059435, 0.024837211765074554, 0.02587410530389003, 0.026952456020397884, 0.02807398926060267, 0.02924049919023543, 0.030453851484124852, 0.03171598633399591, 0.03302892150067502, 0.034394755592432595, 0.03581567098315633, 0.03729393731036176, 0.0388319151829038, 0.0404320598137694, 0.04209692472183002, 0.04382916557031616, 0.04563154434720095, 0.047506933526196796, 0.04945832037654165, 0.051488811575333804, 0.05360163781177417, 0.05580015848506629, 0.058087866910341616, 0.06046839540298893, 0.06294552037583102, 0.06552316810089986, 0.06820542031321847, 0.07099651967920473, 0.07390087618554038, 0.07692307330972255, 0.08006787359039416, 0.08334022584805027, 0.08674527185161907, 0.09028835222550355, 0.09397501402368158, 0.09781101805681659, 0.10180234429822445, 0.10595520047014816, 0.11027602962464406, 0.11477151606713315, 0.11944859343947432, 0.12431445207820294, 0.1293765450594751, 0.13464259659035244, 0.14012060814153046, 0.14581886436148248, 0.15174594110591638, 0.15791070939181454, 0.1643223412893343, 0.17099031615725221, 0.17792442162092617, 0.18513475888995995, 0.19263174500022986, 0.20347874099778274, 0.21147724450582303, 0.21979963736590302, 0.22845739947539093, 0.23746231783208802, 0.24682647689681253, 0.2565622464440761, 0.26668226614004076, 0.27719942615199566, 0.28812684375366227, 0.2994778349777469, 0.3112658812069994, 0.32350458931855014, 0.336207645755374, 0.3493887624737894, 0.3630616152275649, 0.37723977213322746, 0.39193661294356297, 0.40716523550055683, 0.4229383509875754, 0.4392681682366869, 0.4561662575788904, 0.4736434071626444, 0.49170945259577975, 0.5103730986428261, 0.5296417185325529, 0.5495211266215466, 0.5700153390403639, 0.5911263086670944, 0.6128536387798927, 0.635194275384698, 0.658142176017205, 0.6816879603790233, 0.7058185400635841, 0.7305167312689987, 0.7557608561253537, 0.7815243314782083, 0.8077752562687849, 0.8344760008425651, 0.8615828057904564, 0.8890454031223902, 0.9168066678092983, 0.9448023130691906, 0.9729606440385441, 1.0012023846898568, 1.0294405927680046, 1.0575806834216026, 1.0855205747151064, 1.1131509705695495, 1.1403558063953654, 1.1670128546341587, 1.1929945127026458, 1.2181687749202084, 1.2424003896526856, 1.265552196777683, 1.2874866337399324, 1.3080673908611014, 1.3271611893104238, 1.3446396472615463, 1.360381193289134, 1.3742729802733713, 1.3862127537986493, 1.3961105986831295, 1.4038905507549373, 1.4094919834584174, 1.4128707454153449, 1.414, 1.4128707454153449, 1.4094919834584174, 1.4038905507549373, 1.3961105986831295, 1.3862127537986493, 1.3742729802733713, 1.360381193289134, 1.3446396472615463, 1.3271611893104238, 1.3080673908611014, 1.2874866337399324, 1.265552196777683, 1.2424003896526856, 1.2181687749202084, 1.1929945127026458, 1.1670128546341587, 1.1403558063953654, 1.1131509705695495, 1.0855205747151064, 1.0575806834216026, 1.0294405927680046, 1.0012023846898568, 0.9729606440385441, 0.9448023130691906, 0.9168066678092983, 0.8890454031223902, 0.8615828057904564, 0.8344760008425651, 0.8077752562687849, 0.7815243314782083, 0.7557608561253537, 0.7305167312689987, 0.7058185400635841, 0.6816879603790233, 0.658142176017205, 0.635194275384698, 0.6128536387798927, 0.5911263086670944, 0.5700153390403639, 0.5495211266215466, 0.5296417185325529, 0.5103730986428261, 0.49170945259577975, 0.4736434071626444, 0.4561662575788904, 0.4392681682366869, 0.4229383509875754, 0.40716523550055683, 0.39193661294356297, 0.37723977213322746, 0.3630616152275649, 0.3493887624737894, 0.336207645755374, 0.32350458931855014, 0.3112658812069994, 0.2994778349777469, 0.28812684375366227, 0.27719942615199566, 0.26668226614004076, 0.2565622464440761, 0.24682647689681253, 0.23746231783208802, 0.22845739947539093, 0.21979963736590302, 0.21147724450582303, 0.20347874099778274, 0.19263174500022986, 0.18513475888995995, 0.17792442162092617, 0.17099031615725221, 0.1643223412893343, 0.15791070939181454, 0.15174594110591638, 0.14581886436148248, 0.14012060814153046, 0.13464259659035244, 0.1293765450594751, 0.12431445207820294, 0.11944859343947432, 0.11477151606713315, 0.11027602962464406, 0.10595520047014816, 0.10180234429822445, 0.09781101805681659, 0.09397501402368158, 0.09028835222550355, 0.08674527185161907, 0.08334022584805027, 0.08006787359039416, 0.07692307330972255, 0.07390087618554038, 0.07099651967920473, 0.06820542031321847, 0.06552316810089986, 0.06294552037583102, 0.06046839540298893, 0.058087866910341616, 0.05580015848506629, 0.05360163781177417, 0.051488811575333804, 0.04945832037654165, 0.047506933526196796, 0.04563154434720095, 0.04382916557031616, 0.04209692472183002, 0.0404320598137694, 0.0388319151829038, 0.03729393731036176, 0.03581567098315633, 0.034394755592432595, 0.03302892150067502, 0.03171598633399591, 0.030453851484124852, 0.02924049919023543, 0.02807398926060267, 0.026952456020397884, 0.02587410530389003, 0.024837211765074554, 0.023840116137059435, 0.022881222615602922, 0.021958996269094696, 0.021071960682162837, 0.020218695612866787, 0.019397834730351754, 0.018608063478228305, 0.017848116969337177, 0.017116777956511214, 0.01641287489661485, 0.01573528013445323, 0.015082908138322616, 0.014454713680941322, 0.013849690204524702, 0.013266868224347979, 0.012705313823453024, 0.012164127097144649, 0.011642440724412114, 0.01113941858312304, 0.010654254506163066, 0.010186170901399939, 0.009734417507348367, 0.0092982701985523, 0.008877029901967795, 0.008470021426720192, 0.008076592341573381, 0.007696111942149527, 0.007327970228247594, 0.006971577086843333, 0.006626361242333798, 0.0062917692698107805, 0.005967264747583677, 0.005652327387935245, 0.005346452327423158, 0.005049149232986498, 0.004759941463018148, 0.004478365331563373, 0.004203969356709037, 0.003936313645827992, 0.003674969113449635, 0.0034195167498849827, 0.0031695469736482216, 0.002924658968262433, 0.0026844601326867328, 0.0024485653850907416, 0.0022165965118113085, 0.00198818158187645, 0.0017629543462570683, 0.001540553712717782, 0.0013206231201380466, 0.00110280994503885, 0.0008867649487221846, 0.000672141713750514, 0.00045859614295390536, 0.00024578586633974006, 3.33696752724546e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0/)
    
    
!!!! critical
!!!    fld(:,1)   = fldinit + (/0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.33696752724546e-05, 0.00024578586633974006, 0.00045859614295390536, 0.000672141713750514, 0.0008867649487221846, 0.00110280994503885, 0.0013206231201380466, 0.001540553712717782, 0.0017629543462570683, 0.00198818158187645, 0.0022165965118113085, 0.0024485653850907416, 0.0026844601326867328, 0.002924658968262433, 0.0031695469736482216, 0.0034195167498849827, 0.003674969113449635, 0.003936313645827992, 0.004203969356709037, 0.004478365331563373, 0.004759941463018148, 0.005049149232986498, 0.005346452327423158, 0.005652327387935245, 0.005967264747583677, 0.0062917692698107805, 0.006626361242333798, 0.006971577086843333, 0.007327970228247594, 0.007696111942149527, 0.008076592341573381, 0.008470021426720192, 0.008877029901967795, 0.0092982701985523, 0.009734417507348367, 0.010186170901399939, 0.010654254506163066, 0.01113941858312304, 0.011642440724412114, 0.012164127097144649, 0.012705313823453024, 0.013266868224347979, 0.013849690204524702, 0.014454713680941322, 0.015082908138322616, 0.01573528013445323, 0.01641287489661485, 0.017116777956511214, 0.017848116969337177, 0.018608063478228305, 0.019397834730351754, 0.020218695612866787, 0.021071960682162837, 0.021958996269094696, 0.022881222615602922, 0.023840116137059435, 0.024837211765074554, 0.02587410530389003, 0.026952456020397884, 0.02807398926060267, 0.02924049919023543, 0.030453851484124852, 0.03171598633399591, 0.03302892150067502, 0.034394755592432595, 0.03581567098315633, 0.03729393731036176, 0.0388319151829038, 0.0404320598137694, 0.04209692472183002, 0.04382916557031616, 0.04563154434720095, 0.047506933526196796, 0.04945832037654165, 0.051488811575333804, 0.05360163781177417, 0.05580015848506629, 0.058087866910341616, 0.06046839540298893, 0.06294552037583102, 0.06552316810089986, 0.06820542031321847, 0.07099651967920473, 0.07390087618554038, 0.07692307330972255, 0.08006787359039416, 0.08334022584805027, 0.08674527185161907, 0.09028835222550355, 0.09397501402368158, 0.09781101805681659, 0.10180234429822445, 0.10595520047014816, 0.11027602962464406, 0.11477151606713315, 0.11944859343947432, 0.12431445207820294, 0.1293765450594751, 0.13464259659035244, 0.14012060814153046, 0.14581886436148248, 0.15174594110591638, 0.15791070939181454, 0.1643223412893343, 0.17099031615725221, 0.17792442162092617, 0.18513475888995995, 0.19263174500022986, 0.20042611133091526, 0.2085289051215036, 0.21695148659238297, 0.22570552415544698, 0.23480298841472322, 0.24425614290283928, 0.25407753223728186, 0.2642799670646005, 0.27487650499745026, 0.2858804275390683, 0.2973052120569505, 0.30916449866488926, 0.321472050692042, 0.33424170898330696, 0.3474873381853103, 0.3612227651926699, 0.37546170804828954, 0.39021769525198624, 0.4055039727617458, 0.4213333987908747, 0.43771832890801976, 0.45467047933385074, 0.47220078379985275, 0.4903192228112135, 0.5090346451891963, 0.5283545674892749, 0.5482849462535755, 0.568829938173984, 0.5899916346284256, 0.611769774836681, 0.6341614372498848, 0.6571607075582555, 0.6807583283146966, 0.7049413272321114, 0.7296926286796862, 0.7549906532889661, 0.780808904890362, 0.8071155560848469, 0.833873035150184, 0.8610376227425515, 0.8885590705082694, 0.9163802500884232, 0.9444368458157654, 0.9726571057946738, 1.0009616662987961, 1.0292634644581968, 1.0574677598442042, 1.0854722784253719, 1.1131674943203076, 1.140437075172531, 1.1671584880414698, 1.1932037886499955, 1.2184405956672704, 1.2427332513081901, 1.2659441634113655, 1.287935317269732, 1.3085699378547486, 1.327714275709415, 1.3452394819043254, 1.361023530857644, 1.3749531440602565, 1.386925668302394, 1.3968508318731987, 1.4046523651034262, 1.4102693949327116, 1.4136575889802145, 1.41479, 1.4136575889802145, 1.4102693949327116, 1.4046523651034262, 1.3968508318731987, 1.386925668302394, 1.3749531440602565, 1.361023530857644, 1.3452394819043254, 1.327714275709415, 1.3085699378547486, 1.287935317269732, 1.2659441634113655, 1.2427332513081901, 1.2184405956672704, 1.1932037886499955, 1.1671584880414698, 1.140437075172531, 1.1131674943203076, 1.0854722784253719, 1.0574677598442042, 1.0292634644581968, 1.0009616662987961, 0.9726571057946738, 0.9444368458157654, 0.9163802500884232, 0.8885590705082694, 0.8610376227425515, 0.833873035150184, 0.8071155560848469, 0.780808904890362, 0.7549906532889661, 0.7296926286796862, 0.7049413272321114, 0.6807583283146966, 0.6571607075582555, 0.6341614372498848, 0.611769774836681, 0.5899916346284256, 0.568829938173984, 0.5482849462535755, 0.5283545674892749, 0.5090346451891963, 0.4903192228112135, 0.47220078379985275, 0.45467047933385074, 0.43771832890801976, 0.4213333987908747, 0.4055039727617458, 0.39021769525198624, 0.37546170804828954, 0.3612227651926699, 0.3474873381853103, 0.33424170898330696, 0.321472050692042, 0.30916449866488926, 0.2973052120569505, 0.2858804275390683, 0.27487650499745026, 0.2642799670646005, 0.25407753223728186, 0.24425614290283928, 0.23480298841472322, 0.22570552415544698, 0.21695148659238297, 0.2085289051215036, 0.20042611133091526, 0.19263174500022986, 0.18513475888995995, 0.17792442162092617, 0.17099031615725221, 0.1643223412893343, 0.15791070939181454, 0.15174594110591638, 0.14581886436148248, 0.14012060814153046, 0.13464259659035244, 0.1293765450594751, 0.12431445207820294, 0.11944859343947432, 0.11477151606713315, 0.11027602962464406, 0.10595520047014816, 0.10180234429822445, 0.09781101805681659, 0.09397501402368158, 0.09028835222550355, 0.08674527185161907, 0.08334022584805027, 0.08006787359039416, 0.07692307330972255, 0.07390087618554038, 0.07099651967920473, 0.06820542031321847, 0.06552316810089986, 0.06294552037583102, 0.06046839540298893, 0.058087866910341616, 0.05580015848506629, 0.05360163781177417, 0.051488811575333804, 0.04945832037654165, 0.047506933526196796, 0.04563154434720095, 0.04382916557031616, 0.04209692472183002, 0.0404320598137694, 0.0388319151829038, 0.03729393731036176, 0.03581567098315633, 0.034394755592432595, 0.03302892150067502, 0.03171598633399591, 0.030453851484124852, 0.02924049919023543, 0.02807398926060267, 0.026952456020397884, 0.02587410530389003, 0.024837211765074554, 0.023840116137059435, 0.022881222615602922, 0.021958996269094696, 0.021071960682162837, 0.020218695612866787, 0.019397834730351754, 0.018608063478228305, 0.017848116969337177, 0.017116777956511214, 0.01641287489661485, 0.01573528013445323, 0.015082908138322616, 0.014454713680941322, 0.013849690204524702, 0.013266868224347979, 0.012705313823453024, 0.012164127097144649, 0.011642440724412114, 0.01113941858312304, 0.010654254506163066, 0.010186170901399939, 0.009734417507348367, 0.0092982701985523, 0.008877029901967795, 0.008470021426720192, 0.008076592341573381, 0.007696111942149527, 0.007327970228247594, 0.006971577086843333, 0.006626361242333798, 0.0062917692698107805, 0.005967264747583677, 0.005652327387935245, 0.005346452327423158, 0.005049149232986498, 0.004759941463018148, 0.004478365331563373, 0.004203969356709037, 0.003936313645827992, 0.003674969113449635, 0.0034195167498849827, 0.0031695469736482216, 0.002924658968262433, 0.0026844601326867328, 0.0024485653850907416, 0.0022165965118113085, 0.00198818158187645, 0.0017629543462570683, 0.001540553712717782, 0.0013206231201380466, 0.00110280994503885, 0.0008867649487221846, 0.000672141713750514, 0.00045859614295390536, 0.00024578586633974006, 3.33696752724546e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0/)

    
    fld(:,2)   = mominit
    yvec(nVar) = 0 ! Add a tcur pointer here

  end subroutine initialise_fields

  subroutine time_evolve(sim, alp) 
    real(dl) :: dt
    real(dl) :: dtout
    real(dl) :: alp
    integer :: j, k
    integer :: sim
    integer :: m
    real(dl), dimension(1:size(fld(:,1)), 2) :: df

    df = fld(:,:)

    dt = dx / alp
    if (dt > dx) print*, "Warning, violating Courant condition"
    dtout = dt * alp

    k = 0

    call output_fields(df, dtout, sim)

    do while ( k < nTimeMax )
       do j = 1, int(alp)
          call gl10(yvec, dt)
       end do

       call output_fields(fld, dtout, sim)
       k = k+1
    end do
  end subroutine time_evolve

  subroutine setup(nVar)
    integer, intent(in) :: nVar
    call init_integrator(nVar)
    call initialize_transform_1d(tPair,nLat)
    call initialize_transform_1d(tPairgsq,nLat)
  end subroutine setup

  character(len=20) function str(k)
    integer, intent(in) :: k
    write (str, *) k
    str = adjustl(str)
  end function str

  character(len=20) function real_str(k)
    real(dl), intent(in) :: k
    write (real_str, '(f12.4)') k
    real_str = adjustl(real_str)
  end function real_str

  subroutine output_fields(fld, dtout, sim)
    real(dl), dimension(1:nLat, 1:2) :: fld
    real(dl) :: dtout
    integer  :: m, sim
    logical  :: o
    integer, parameter :: oFile = 98

    !inquire(file='/gpfs/dpirvu/prefactor/x'//trim(str(nLat))//'_m2eff'//trim(real_str(m2eff))//'_T'//trim(real_str(temp))//'_sim'//trim(str(sim))//'instanton_critical_fields.dat', opened=o)
    inquire(file='/gpfs/dpirvu/prefactor/x'//trim(str(nLat))//'_m2eff'//trim(real_str(m2eff))//'_T'//trim(real_str(temp))//'_sim'//trim(str(sim))//'instanton_sub_critical_fields.dat', opened=o)

    if (.not.o) then
       !open(unit=oFile,file='/gpfs/dpirvu/prefactor/x'//trim(str(nLat))//'_m2eff'//trim(real_str(m2eff))//'_T'//trim(real_str(temp))//'_sim'//trim(str(sim))//'instanton_critical_fields.dat')
       open(unit=oFile,file='/gpfs/dpirvu/prefactor/x'//trim(str(nLat))//'_m2eff'//trim(real_str(m2eff))//'_T'//trim(real_str(temp))//'_sim'//trim(str(sim))//'instanton_sub_critical_fields.dat')
       write(oFile,*) "dx", dx
       write(oFile,*) "nLat", nLat
       write(oFile,*) "lenLat", lenLat
       write(oFile,*) "dk", dk
       write(oFile,*) "dtout", dtout
       write(oFile,*) "m2eff", m2eff
       write(oFile,*) "temperature", temp
       write(oFile,*) "tstart", 0
    endif

    do m = 1, nLat
       write(oFile,*) fld(m,:)
    end do

  end subroutine output_fields

end program Gross_Pitaevskii_1d
